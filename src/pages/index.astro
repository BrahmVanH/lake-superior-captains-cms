---
export const prerender = false;
import { API_URL_DEV } from 'astro:env/server';

import Layout from '../layouts/Layout.astro';

import { graphQLFetch, fetchPropertyImgs, PropertyNames } from '@/lib/API/index';

import { GET_COTTAGE_IMGS, GET_HIDEAWAY_IMGS, GET_PROPERTIES as query } from '@/lib/API/queries';
import type { Property } from '@/lib/__generated__/types';

console.log(API_URL_DEV);
const gqlRes = await graphQLFetch(query);

console.log('properties: ', gqlRes);

if (!gqlRes?.getProperties) {
	throw new Error('Error - properties data not present on fetch response');
}

const properties: Property[] = gqlRes.getProperties;

const propertiesCardData = await properties.map(async (property) => {
	const imgs = await fetchPropertyImgs(property.propertyName as PropertyNames);
	if (!imgs) {
		throw new Error('No imgs returned from fetch request');
	}
	return {
		galleryArray: imgs,
		property,
	};
});
---

<Layout title={'Dashboard'} >
